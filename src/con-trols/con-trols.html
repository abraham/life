<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-swatch-picker/paper-swatch-picker.html">

<script src='../../bower_components/vibrant/dist/Vibrant.min.js'></script>

<dom-module id="con-trols">
  <template>
    <style>
      :host {
        display: block;
        background-color: white;
      }

      paper-slider.blue {
        --paper-slider-knob-color: var(--paper-blue-a700);
        --paper-slider-active-color: var(--paper-blue-a700);
        --paper-slider-secondary-color: var(--paper-grey-600);
      }

      .label {
        margin: 16px;
      }
    </style>

    <paper-card>
      <div class="card-content">
        <div>
          <div class='label'>Size</div>
          <paper-slider id='layers' class='blue' pin disabled="[[sliderDisabled]]" value='{{settings.size}}' min='1' max='50' secondary-progress='50'></paper-slider>
        </div>

        <div>
          <div class='label'>% of cells initially alive</div>
          <paper-slider id='fill-percent' class='blue' pin disabled="[[sliderDisabled]]" value='{{settings.initiallyAlive}}' min='1' max='100' secondary-progress='100'></paper-slider>
        </div>

        <div>
          <div class='label'>Color <paper-swatch-picker color='{{colors.primary}}'></paper-swatch-picker></div>
        </div>
      </div>

      <div class="card-actions" data-state='stopped'>
        <paper-button id='state'>[[stateText]]</paper-button>
        <paper-button id='reset'>Reset</paper-button>
      </div>
    </paper-card>
  </template>

  <script>
  {
    const defaultColors = { primary: '#2196F3', secondary: '#ffffff' };
    const defaultSettings = { size: 21, initiallyAlive: 42 };
    const RESET_STATE = 'reset';
    const PLAYING_STATE = 'playing';
    const STOPPED_STATE = 'stopped';

    Polymer({
      is: 'con-trols',

      properties: {
        colors: {
          type: Object,
          notify: true,
          value: () => defaultColors
        },
        settings: {
          type: Object,
          notify: true,
          value: () => defaultSettings
        },
        state: {
          type: String,
          notify: true,
          value: RESET_STATE
        },
        stateText: {
          type: String,
          computed: '_computeStateText(state)'
        },
        sliderDisabled: {
          type: Boolean,
          computed: '_computeSliderDisabled(state)'
        }
      },

      listeners: {
        'color-picker-selected': '_onColorSelected',
        'state.click': '_onStateClick',
        'reset.click': '_onResetClick'
      },

      _computeSliderDisabled: function(state) {
        return state === RESET_STATE ? false : true;
      },
      _computeStateText: function(state) {
        return state === PLAYING_STATE ? 'Pause' : 'Play';
      },

      _onColorSelected: function(event) {
        this.colors = {
          primary: event.detail.color,
          secondary: this._complementaryColor(event.detail.color)
        };
      },
      _onStateClick: function(event) {
        this.state = this.state === PLAYING_STATE ? STOPPED_STATE : PLAYING_STATE
      },
      _onResetClick: function() {
        this.state = RESET_STATE;
      },

      _hexToRgb: function(hex) {
        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return [
            parseInt(result[1], 16),
            parseInt(result[2], 16),
            parseInt(result[3], 16)
        ];
      },
      _complementaryColor: function(hex) {
        var swatch = new Swatch(this._hexToRgb(hex));
        return swatch.getTitleTextColor();
      }
    });
  }
  </script>
</dom-module>
